//////////////////////////////////////////////////////////////////////////
//    File        	: LightComponent.cpp
//    Created By    : Jack Spink
//    Created On 	: [3/12/2019]
//////////////////////////////////////////////////////////////////////////

#include "GameFramework/Component/LightComponent.h"

//////////////////////////////////////////////////////////////////////////

#include "Core/Object.h"
#include "Core/RTTI/RTTI.h"

//////////////////////////////////////////////////////////////////////////

#include "Render/Effects/LightManager.h"

//////////////////////////////////////////////////////////////////////////

RTTI_BEGIN_WITH_BASE(LightComponent, TransformComponent)
    RTTI_PROPERTY(LightComponent, f32, radius)
    RTTI_PROPERTY(LightComponent, float3, color, Color=true)
RTTI_END()

//////////////////////////////////////////////////////////////////////////

LightComponent::LightComponent()
{
    parentTransform.componentName = "RootTransform";
}

//////////////////////////////////////////////////////////////////////////

void LightComponent::OnConstruct()
{
    Super::OnConstruct();

    light = GetLightManager()->InsertInstance(vec3(0.0f), radius, vec4(color, 1.0f));
    light->SetPosition(GetTransformedLightPosition());
}

//////////////////////////////////////////////////////////////////////////

void LightComponent::OnDestruct()
{
    Super::OnDestruct();

    GetLightManager()->RemoveInstance(light);
    light = nullptr;
}

//////////////////////////////////////////////////////////////////////////

void LightComponent::OnTick(const f32 dt)
{
    Super::OnTick(dt);

    light->SetRadius(radius);
    light->SetColor(vec4(color, 1.0f));
    light->SetPosition(GetTransformedLightPosition());
}

//////////////////////////////////////////////////////////////////////////
